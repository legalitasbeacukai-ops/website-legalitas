<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Legalitas Bea Cukai — Cek Resi</title>
  <meta name="description" content="Sistem cek legalitas pengiriman bekerja sama dengan Direktorat Jenderal Bea dan Cukai (contoh tampilan surat pemberitahuan)." />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.06);
      --accent: #00eaff;
      --muted-white: rgba(255,255,255,0.9);
      --card-radius: 16px;
      --max-width: 980px;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:"Poppins",sans-serif;background:
      radial-gradient(1200px 600px at 10% 20%, rgba(0,234,255,0.06), transparent 8%),
      linear-gradient(180deg,#081021 0%,#07121a 60%);
      color:var(--muted-white);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
    }

    .wrap{max-width:var(--max-width);margin:28px auto;padding:24px;}
    header{
      display:flex;gap:16px;align-items:center;margin-bottom:18px;
    }
    .brand {
      width:64px;height:64px;border-radius:12px;background:linear-gradient(135deg,#002F4B,#007C91);
      display:flex;align-items:center;justify-content:center;font-weight:700;font-size:20px;color:white;
      box-shadow:0 6px 22px rgba(0,0,0,0.45);
    }
    h1{font-size:20px;margin:0}
    p.lead{margin:4px 0 0;color:rgba(255,255,255,0.72);font-size:13px}

    .grid{
      display:grid;grid-template-columns: 360px 1fr;gap:20px;margin-top:18px;
    }

    /* form card */
    .card{
      background:var(--glass-bg);padding:18px;border-radius:var(--card-radius);
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);backdrop-filter: blur(8px);
    }
    label{display:block;font-size:13px;margin-top:12px;color:rgba(255,255,255,0.85)}
    input, select, textarea{
      width:100%;padding:10px 12px;margin-top:8px;border-radius:10px;border:none;background:rgba(255,255,255,0.04);
      color:var(--muted-white);font-size:14px;outline:none;
    }
    .muted{font-size:12px;color:rgba(255,255,255,0.6);margin-top:6px}

    .btn{
      display:inline-block;padding:12px 14px;border-radius:10px;border:none;cursor:pointer;font-weight:600;
      background:linear-gradient(90deg,var(--accent),#5ef7ff);color:#001; margin-top:14px;width:100%;
      box-shadow:0 6px 18px rgba(0,234,255,0.06), inset 0 -3px 8px rgba(0,0,0,0.12);
    }
    .btn.secondary{background:transparent;color:var(--accent);border:1px solid rgba(255,255,255,0.06);width:auto;padding:10px 12px}

    /* result area */
    .preview{
      min-height:320px;overflow:auto;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:var(--card-radius);
      border:1px solid rgba(255,255,255,0.02);
    }

    .letter {
      background:white;color:#07323f;border-radius:10px;padding:18px;max-width:780px;margin:0 auto;
      box-shadow:0 8px 30px rgba(0,0,0,0.4);
      font-size:14px;line-height:1.5;
      font-family: "Poppins", sans-serif;
    }
    .letter h2{margin:0 0 8px 0;font-size:16px;color:#022430}
    .letter .meta{font-size:13px;color:#2d666e;margin-bottom:12px}
    .letter .section-title{font-weight:700;margin-top:12px;color:#0b3a3f}
    table.fees{width:100%;border-collapse:collapse;margin-top:8px}
    table.fees td, table.fees th{padding:8px;border-bottom:1px dashed rgba(0,0,0,0.06)}
    table.fees th{text-align:left;background:rgba(0,0,0,0.02);font-weight:600}

    .actions{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-top:14px}
    .small{font-size:13px;color:rgba(2,6,23,0.6)}

    footer{margin-top:18px;text-align:center;font-size:13px;color:rgba(255,255,255,0.5)}
    @media (max-width:900px){
      .grid{grid-template-columns:1fr;align-items:start}
      .brand{width:56px;height:56px}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand" aria-hidden="true">BC</div>
      <div>
        <h1>Legalitas Bea Cukai — Cek Resi</h1>
        <p class="lead">Masukkan data pengiriman untuk menampilkan surat pemberitahuan contoh. Sistem ini hanya menampilkan format surat.</p>
      </div>
    </header>

    <main class="grid" role="main">
      <!-- left: input -->
      <section class="card" aria-labelledby="form-title">
        <h2 id="form-title" style="margin:0;font-size:16px">Form Cek Legalitas</h2>
        <p class="muted">Isikan Nomor Resi dan data pengirim/penerima. Contoh resi: <code>BC-78291-XX</code></p>

        <label for="resi">Nomor Resi / Kode Pengiriman</label>
        <input id="resi" type="text" placeholder="Contoh: BC-78291-XX" inputmode="text" />

        <label for="pengirim">Nama Pengirim</label>
        <input id="pengirim" type="text" placeholder="Nama pengirim" />

        <label for="penerima">Nama Penerima</label>
        <input id="penerima" type="text" placeholder="Nama penerima" />

        <label for="keterangan">Catatan (opsional)</label>
        <textarea id="keterangan" rows="3" placeholder="Tambahkan keterangan tambahan jika perlu"></textarea>

        <button id="cekBtn" class="btn" type="button">Cek Legalitas & Tampilkan Surat</button>

        <div style="margin-top:10px" aria-hidden="true">
          <button id="clearBtn" class="btn secondary" type="button">Kosongkan</button>
        </div>
      </section>

      <!-- right: preview -->
      <section class="preview card" aria-live="polite">
        <div id="placeholder">
          <p style="margin:0 0 8px 0;color:rgba(255,255,255,0.7)">Preview surat pemberitahuan akan muncul di sini setelah Anda menekan <strong>“Cek Legalitas & Tampilkan Surat”</strong>.</p>
          <p style="font-size:13px;color:rgba(255,255,255,0.55)">Surat ini dibuat berdasarkan keterangan yang Anda sediakan (format & template contoh).</p>
        </div>

        <div id="result" style="display:none">
          <div id="letter-wrap" class="letter" role="article" aria-label="Surat Pemberitahuan">
            <!-- Letter content will be injected here -->
          </div>

          <div class="actions" style="margin-top:14px">
            <button id="downloadPdfBtn" class="btn" type="button">Download PDF</button>
            <button id="printBtn" class="btn secondary" type="button">Print</button>
            <div style="flex:1"></div>
            <div class="small">Format surat: <strong>Notifikasi & Rincian Biaya</strong></div>
          </div>
        </div>
      </section>
    </main>

    <footer>
      © 2025 Legalitas Bea Cukai — Template Surat & Demo. Dokumen ini adalah contoh tampilan; bukan bukti resmi.
    </footer>
  </div>

  <!-- External libs for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" integrity="" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" integrity="" crossorigin="anonymous"></script>

  <script>
    // Utility: sanitize text for injection
    function esc(s){
      if(!s) return "";
      return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;");
    }

    // Fixed data from keterangan (per Anda)
    const BKC_INFO = {
      description: "Rokok tanpa pita cukai resmi sebanyak 16 slop (3.200 batang).",
      quantity_batang: 3200,
      tarif_per_batang: 600,
      biaya_lanjutan: 80000,
      refund_ratio: 0.75 // 75%
    };

    function formatRp(n){
      return "Rp " + n.toLocaleString('id-ID') + ",00";
    }

    // Compose letter HTML
    function makeLetterHTML({resi, pengirim, penerima, note}) {
      const qty = BKC_INFO.quantity_batang;
      const tarif = BKC_INFO.tarif_per_batang;
      const nilai_cukai = tarif * qty;
      const biaya = BKC_INFO.biaya_lanjutan;
      const total = nilai_cukai + biaya;
      const refund_amount = Math.round(total * BKC_INFO.refund_ratio);
      const retain_amount = total - refund_amount;

      const today = new Date();
      const dd = String(today.getDate()).padStart(2,'0');
      const mm = String(today.getMonth()+1).padStart(2,'0');
      const yyyy = today.getFullYear();
      const tanggal = dd + "/" + mm + "/" + yyyy;

      return `
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <div style="font-weight:700;color:#022430">DIREKTORAT JENDERAL BEA DAN CUKAI</div>
          <div style="text-align:right;font-size:12px;color:#2d666e">${tanggal}</div>
        </div>

        <h2>PEMBERITAHUAN HASIL PEMERIKSAAN</h2>
        <div class="meta">Perihal: Notifikasi Temuan Barang Kena Cukai Ilegal</div>

        <p>Dengan hormat,</p>

        <p>Sehubungan dengan proses pengiriman paket Anda dengan nomor resi <strong>${esc(resi)}</strong>, bersama ini kami sampaikan bahwa berdasarkan hasil pemeriksaan rutin oleh pihak ekspedisi yang bekerja sama dengan Direktorat Jenderal Bea dan Cukai, ditemukan bahwa paket tersebut mengandung produk berupa:</p>

        <blockquote style="background:#f4f8f8;padding:10px;border-left:4px solid #0b9aa1;margin:0 0 12px 0;color:#084046">
          ${esc(BKC_INFO.description)}
        </blockquote>

        <p class="section-title">Dasar Hukum</p>
        <p style="margin:6px 0;color:#254f52">
          Berdasarkan ketentuan yang berlaku, barang tersebut termasuk dalam kategori Barang Kena Cukai (BKC) ilegal dan melanggar ketentuan sebagaimana diatur dalam:
        </p>
        <p style="font-style:italic;color:#254f52">Undang-Undang Nomor 39 Tahun 2007 tentang Cukai, Pasal 54.</p>

        <p class="section-title">Tindakan Pencegahan dan Penyelesaian</p>
        <p>Untuk menghindari sanksi hukum lebih lanjut dan demi menyelesaikan permasalahan legalitas pengiriman, pemilik barang diwajibkan untuk melakukan pembayaran jaminan legalitas sementara, dengan rincian sebagai berikut:</p>

        <table class="fees" aria-hidden="true">
          <tr><th>Uraian</th><th style="text-align:right">Jumlah</th></tr>
          <tr><td>Nilai cukai (Rp ${tarif} x ${qty} batang)</td><td style="text-align:right">${formatRp(nilai_cukai)}</td></tr>
          <tr><td>Biaya lanjutan pengiriman</td><td style="text-align:right">${formatRp(biaya)}</td></tr>
          <tr><th>Total yang harus diselesaikan</th><th style="text-align:right">${formatRp(total)}</th></tr>
        </table>

        <p style="margin-top:10px">Jumlah tersebut dicatat sebagai jaminan legalitas sementara, bukan merupakan denda tetap, melainkan sebagai bagian dari proses klarifikasi dan pengesahan dokumen pengiriman.</p>

        <p class="section-title">Syarat dan Ketentuan</p>
        <ol>
          <li><strong>Batas Waktu Pembayaran:</strong> Pembayaran wajib dilakukan segera setelah menerima pemberitahuan ini. Jika tidak diselesaikan dalam batas waktu yang ditentukan, barang akan diserahkan ke pihak Bea dan Cukai untuk diproses sesuai hukum yang berlaku.</li>
          <li><strong>Pengembalian Dana (Refund):</strong> Setelah proses verifikasi legalitas selesai dan pembayaran diterima, maka: 75% dari total pembayaran (<strong>${formatRp(refund_amount)}</strong>) akan dikembalikan kepada pemilik barang. 25% (<strong>${formatRp(retain_amount)}</strong>) akan dipotong untuk biaya administrasi pengecekan dan legalisasi.</li>
          <li><strong>Konsekuensi Hukum:</strong> Jika pembayaran tidak dilakukan sesuai ketentuan: Barang akan ditahan, disita, dan diproses hukum oleh Direktorat Jenderal Bea dan Cukai. Proses hukum mengacu pada Undang-Undang Nomor 39 Tahun 2007 tentang Cukai dan peraturan pelaksanaannya.</li>
        </ol>

        <p>Demikian surat pemberitahuan ini kami sampaikan untuk menjadi perhatian. Atas kerja sama dan pengertiannya, kami ucapkan terima kasih.</p>

        <p style="margin-top:18px">Hormat kami,<br>
        <strong>Tim Legalitas &amp; Pemeriksaan Barang</strong><br>
        (Ekspedisi — Dalam kerjasama dengan Direktorat Jenderal Bea dan Cukai)</p>

        <hr style="border:none;border-top:1px solid rgba(0,0,0,0.06);margin:16px 0">

        <p style="font-size:13px;color:#235e63;margin:0"><strong>Detail Pengiriman</strong></p>
        <p style="margin:6px 0 0 0"><b>Nomor Resi:</b> ${esc(resi)} &nbsp; | &nbsp; <b>Pengirim:</b> ${esc(pengirim)} &nbsp; | &nbsp; <b>Penerima:</b> ${esc(penerima)}</p>

        ${ note ? `<p style="margin-top:8px"><em>Catatan:</em> ${esc(note)}</p>` : "" }
      `;
    }

    // Elements
    const resiEl = document.getElementById('resi');
    const pengirimEl = document.getElementById('pengirim');
    const penerimaEl = document.getElementById('penerima');
    const keteranganEl = document.getElementById('keterangan');
    const cekBtn = document.getElementById('cekBtn');
    const clearBtn = document.getElementById('clearBtn');
    const placeholder = document.getElementById('placeholder');
    const resultWrap = document.getElementById('result');
    const letterWrap = document.getElementById('letter-wrap');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');
    const printBtn = document.getElementById('printBtn');

    // basic validation
    function validateInputs(){
      const r = resiEl.value.trim();
      const p = pengirimEl.value.trim();
      const t = penerimaEl.value.trim();
      if(!r || !p || !t){
        alert("Lengkapi semua data: Nomor Resi, Nama Pengirim, dan Nama Penerima.");
        return false;
      }
      return true;
    }

    cekBtn.addEventListener('click', ()=> {
      if(!validateInputs()) return;
      const payload = {
        resi: resiEl.value.trim(),
        pengirim: pengirimEl.value.trim(),
        penerima: penerimaEl.value.trim(),
        note: keteranganEl.value.trim()
      };
      // put letter HTML
      letterWrap.innerHTML = makeLetterHTML(payload);
      placeholder.style.display = 'none';
      resultWrap.style.display = 'block';

      // give focus to result for accessibility
      letterWrap.setAttribute('tabindex','-1');
      letterWrap.focus();
    });

    clearBtn.addEventListener('click', ()=>{
      resiEl.value = "";
      pengirimEl.value = "";
      penerimaEl.value = "";
      keteranganEl.value = "";
      resultWrap.style.display = 'none';
      placeholder.style.display = 'block';
    });

    // Print
    printBtn.addEventListener('click', ()=>{
      // open printable window
      const popup = window.open('', '_blank', 'width=900,height=700,scrollbars=yes');
      popup.document.write('<!doctype html><html><head><meta charset="utf-8"><title>Print Surat</title>');
      popup.document.write('<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">');
      popup.document.write('<style>body{font-family:Poppins,Arial;background:#f5f7f8;padding:20px;color:#07323f} .letter{background:white;padding:20px;border-radius:8px;}</style></head><body>');
      popup.document.write('<div class="letter">' + letterWrap.innerHTML + '</div>');
      popup.document.write('</body></html>');
      popup.document.close();
      popup.focus();
      setTimeout(()=>popup.print(), 500);
    });

    // Download PDF (using html2canvas + jsPDF)
    downloadPdfBtn.addEventListener('click', async ()=>{
      // disable button while rendering
      downloadPdfBtn.disabled = true;
      downloadPdfBtn.textContent = "Mempersiapkan PDF...";

      // select the element to convert
      const element = letterWrap;

      try {
        // Use html2canvas to render at high scale for clarity
        const canvas = await html2canvas(element, {
          scale: 2,
          useCORS: true,
          backgroundColor: null,
          scrollY: -window.scrollY
        });
        const imgData = canvas.toDataURL("image/png");
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF({
          orientation: (canvas.width > canvas.height) ? 'landscape' : 'portrait',
          unit: 'px',
          format: [canvas.width, canvas.height]
        });

        pdf.addImage(imgData, 'PNG', 0, 0, canvas.width, canvas.height);
        const filename = `surat_legalitas_${resElSafeFilename()}.pdf`;
        pdf.save(filename);
      } catch(err){
        console.error(err);
        alert("Gagal membuat PDF. Silakan coba ulang atau gunakan tombol Print.");
      } finally {
        downloadPdfBtn.disabled = false;
        downloadPdfBtn.textContent = "Download PDF";
      }
    });

    function resElSafeFilename(){
      const r = (resiEl.value || "no_resi").replaceAll(/\s+/g, "_").replaceAll(/[^a-zA-Z0-9_\-]/g, "");
      return r;
    }

    // small accessibility improvements: submit on Enter in last field
    penerimaEl.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter') {
        e.preventDefault();
        cekBtn.click();
      }
    });

  </script>
</body>
</html>
